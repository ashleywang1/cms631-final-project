<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Car Fuel Efficiency Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <style>
      body {
        background: #f5f5f5;
        position: absolute;
        top: 0; bottom: 0;
        left: 0; right: 0;
      }

      select {
        margin: 10px;
        padding: 10px;
      }

      .example_car {
        width: 100px;
        height: 100px;
        padding: 0.5em;
        float: left;
        margin: 110px 10px 10px 30px;
      }

      .example_car img{
        width: 100%;
      }

      .percentile {
        display: inline-block;
        width: 19.5%;
        height: 100%;
      }

      #draggable {
        width: 100px;
        height: 100px;
        padding: 0.5em;
        float: left;
        margin: 10px 10px 10px 0;
      }

      #draggable img{
        width: 100%;
        cursor: pointer;
      }

      #getYourCar {
        margin: 10px;
      }

      #getRandomCar {
        margin: 10px;
      }

      .carLabel {
        font-size: 12px;
      }

      #droppable {
        width: 100%;
        height: 150px; 
        float: left; 
      }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../js/car_data.js"></script>
    <script src="js/logger.js"></script>
    <script>

      var getCarInfo = function () {
          var mfr = $("#manufacturer")[0].options[$("#manufacturer")[0].selectedIndex].text
          var car = $("#carType")[0].options[$("#carType")[0].selectedIndex].text
          return car_data.filter(
            function(c){ return c.mfr == mfr && c.car == car }
          )[0];
      };

      function getCarOptions(mfr) {
        return car_data.filter(
          function(c){ return c.mfr == mfr }
        );
      }

      $( function() {
        // Set up the text
        $("#right").hide();
        $("#wrong").hide();

        // Set up the car selection
        metadata.forEach(function(c) {
          $("#manufacturer").append("<option>" + c.mfr +"</option>");
        });

        getCarOptions("aston martin").forEach(function(c) {
          $("#carType").append("<option>" + c.car + "</option>");
          // console.log(c.car);
        })

        // Set up the drag and drop game
        $( "#draggable" ).draggable();
        $( "#droppable" ).droppable({
          drop: function( event, ui ) {
            var OFFSET = 20;
            console.log(event);
            var percentage = ((ui.offset.left + OFFSET)/$( this ).width())*100;
            var car = getCarInfo();
            var l, h;
            switch(car.score) {
              case 0:
                l = -3;
                h = 16;
                break;
              case 25:
                l = 18;
                h = 36;
                break;
              case 50:
                l = 37;
                h = 56;
                break;
              case 75:
                l = 58;
                h = 76;
                break;
              case 100:
                l = 78;
                h = 92;
                break;
            }
            if (percentage > l && percentage < h) {
              console.log("correct");
              $("#right").show();
              $("#wrong").hide();
            } else {
              $("#right").hide();
              $("#wrong").show();
              console.log("wrong");
            }
            $( this )
              // .addClass( "ui-state-highlight" )
              .find( "p" )
                .html(percentage.toFixed(0) + "%");
          }
        });

        // Set up selection and button handlers
        document.getElementById("manufacturer").onchange = function(e) {
          var mfr = $("#manufacturer")[0].options[e.target.selectedIndex].value
          $("#carType").html("");
          getCarOptions(mfr).forEach(function(c) {
            $("#carType").append("<option>" + c.car + "</option>");
          });
        };

        document.getElementById("getYourCar").onclick = function(e) {
          $("#draggable").html("");
          var mfr = $("#manufacturer")[0].options[$("#manufacturer")[0].selectedIndex].text
          var car = $("#carType")[0].options[$("#carType")[0].selectedIndex].text
          $("#draggable").append("<img src='../img/yCar.png'/><center><label class='carLabel'>" + mfr + " " + car + "</label></center>");
          Logger.log({"event": "car_manufacturer", mfr});
          Logger.log({"event": "car_type", car});
        }

        document.getElementById("getRandomCar").onclick = function(e) {
          $("#draggable").html("");
          $("#draggable").append("<img src='../img/yCar.png'/><center><label class='carLabel'>Your car</label></center>");
        }

        // prevent dragging default
        $(document).on('mousedown', ".example_car img", function(evt) {
          evt.preventDefault();
        });

      });

    </script>
  </head>
  <body>
    <div class="title" id="instructions" width="50%">
      <h1>How fuel efficient do you think your car is?</h1>
    </div>
    <div id="garage">
      <p>What kind of car do you have?</p>
      <select name="manufactuer" id="manufacturer">
      </select>
      <select name="carType" id="carType">
      </select>
      <button type="button" id="getYourCar"> Get your car </button>
      <span> Can't find yours? </span>
      <button type="button" id="getRandomCar">Random car </button>
    </div>
    <div id="draggable"></div>
     
    <div id="droppable">
      <p style="position: absolute;">Drag your car here</p>
      <!-- ["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"] -->
      <div class="percentile" value="0" style="background:#edf8e9">
        <div class="example_car">
          <img src="../img/lamborghini.png" />
          <center><label class="carLabel">Lamborghini</label></center>
        </div>
      </div>
      <div class="percentile" value="25" style="background:#bae4b3">
        <div class="example_car">
          <img src="../img/ford_focus.png" />
          <center><label class="carLabel">Ford Focus</label></center>
        </div>
      </div>
      <div class="percentile" value="50" style="background:#74c476">
        <div class="example_car">
          <img src="../img/audi.png" />
          <center><label class="carLabel">Volkswagon Audi</label></center>
        </div>
      </div>
      <div class="percentile" value="75" style="background:#31a354">
        <div class="example_car">
          <img src="../img/honda_accord.png" />
          <center><label class="carLabel">Honda Accord</label></center>
        </div>
      </div>
      <div class="percentile" value="100" style="background:#006d2c">
        <div class="example_car">
          <img src="../img/toyota_prius.png" />
          <center><label class="carLabel">Toyota Prius</label></center>
        </div>
      </div>
    </div>
    <br>
    <div id="result">
      <p id="wrong">Drag the car into the category you think it belongs to. You're not quite there yet!</p>
      <p id="right">You've got it! This car has a fuel efficiency of <span id="fe"></span> miles per gallon, which puts it into the <span id="fe_percent"></span>th percentile of all the cars in our dataset!</p>
    </div>
  </body>
</html>