<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <script src="https://maps.google.com/maps/api/js?sensor=false&key=AIzaSyB9R73RQs2X2n3J8xpPKez_1hotrCwInH8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.3.3/vue.min.js"></script>

    <title>Car Fuel Efficiency Quiz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.1/css/bulma.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <style>
      body {
        background: #f5f5f5;
        position: absolute;
        top: 0; bottom: 0;
        left: 0; right: 0;
      }

      #carSelection {
        display: block;
        padding: 10px;
      }

      .car {
        width: 100px;
        height: 100px;
        padding: 0.5em;
        float: left;
        margin: 10px 10px 10px 0;
      }

      .car img{
        width: 100%;
        cursor: pointer;
      }

      .carLabel {
        font-size: 12px;
      }
      
      select {
        margin: 10px;
        padding: 10px;
      }

      .percentile_label {
        padding: 0.5em;
        float: left;
      }

      .percentile {
        display: inline-block;
        width: 19.5%;
        height: 100%;
      }

      #draggable {
        width: 100px;
        height: 100px;
        padding: 0.5em;
        float: left;
        margin: 10px 10px 10px 0;
      }

      #draggable img{
        width: 100%;
        cursor: pointer;
      }

      .carLabel {
        font-size: 12px;
      }

      #droppable {
        width: 100%;
        height: 150px;
      }

      #result {
        padding: 10px;
      }
    </style>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../js/car_data.js"></script>
    <script src="../js/logger.js"></script>
    <script>

      var getCarInfo = function () {
          var mfr = $("#manufacturer")[0].options[$("#manufacturer")[0].selectedIndex].text
          var car = $("#carType")[0].options[$("#carType")[0].selectedIndex].text
          return car_data.filter(
            function(c){ return c.mfr == mfr && c.car == car }
          )[0];
      };

      function getCarOptions(mfr) {
        return car_data.filter(
          function(c){ return c.mfr == mfr }
        );
      }

      $( function() {
        // Set up the text
        $(".result").hide();
        $("#garage").hide();

        // Set up the car selection
        metadata.forEach(function(c) {
          $("#manufacturer").append("<option>" + c.mfr +"</option>");

        });
        $("#manufacturer")[0].selectedIndex = 0;
        $("#carType").append("<option disabled>Car Make and Model</option>");
        $("#carType")[0].selectedIndex = 0;

        // getCarOptions("aston martin").forEach(function(c) {
        //   $("#carType").append("<option>" + c.car + "</option>");
        // })

        // Set up the drag and drop game
        $( "#draggable" ).draggable();
        $( "#droppable" ).droppable({
          drop: function( event, ui ) {
            var OFFSET = 20;
            console.log(event);
            var percentage = ((ui.offset.left + OFFSET)/$( this ).width())*100;
            var car = getCarInfo();
            var l, h, correct;
            switch(car.score) {
              case 0:
                l = -3;
                h = 16;
                correct = "right_bad";
                break;
              case 25:
                l = 18;
                h = 36;
                correct = "right_bad";
                break;
              case 50:
                l = 37;
                h = 56;
                correct = "right_middle";
                break;
              case 75:
                l = 58;
                h = 76;
                correct = "right_good";
                break;
              case 100:
                l = 78;
                h = 92;
                correct = "right_good";
                break;
            }
            if (percentage > l && percentage < h) {
              console.log("correct");
              $(".fe_percent").html(car.score);
              $(".fe").html(car.fe);
              $(".result").hide();
              $("#" + correct).show();
            } else if (percentage < l) {
              // guessed too low
              $(".result").hide();
              $("#low").show();
              console.log("wrong");
            } else if (percentage > h) {
              $(".result").hide();
              $("#high").show();
            }
          }
        });

        // Set up selection and button handlers
        document.getElementById("manufacturer").onchange = function(e) {
          var mfr = $("#manufacturer")[0].options[e.target.selectedIndex].value
          $("#carType").html("");
          getCarOptions(mfr).forEach(function(c) {
            $("#carType").append("<option>" + c.car + "</option>");
          });
        };

        document.getElementById("carType").onchange = function(e) {
          var mfr = $("#manufacturer")[0].options[$("#manufacturer")[0].selectedIndex].text
          var car = $("#carType")[0].options[$("#carType")[0].selectedIndex].text
          // var id = mfr + car;
          // $("#" + id).html("");
          $("#draggable").append("<img src='../img/yCar.png'/><center><label class='carLabel'>" + mfr + "</label></center>");
          
          $( "#garage").show();
          Logger.log({"event": "car_manufacturer", mfr});
          Logger.log({"event": "car_type", car});
        }
      });

    </script>
  </head>
  <body>
    <div class="columns is-multiline is-mobile">
      <div class="column is-7">
        <div id="carSelection">
          <p>Choose your car</p>
          <select class="select" name="manufactuer" id="manufacturer">
            <option disabled> Manufacturer </option>
          </select>
          <select class="select" name="carType" id="carType">
            <option disabled> Car Make and Model </option>
          </select>
          <br>
        </div>
      </div>
      <div class="column is-3" id="garage">
        <p style="padding:10px;">Drag this car to the place on the scale below!</p>
      </div>
      <div class="column is-2">
        <div id="draggable"></div>
      </div>
      <div class="column is-12">
        <div id="droppable">
          <!-- ["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"] -->
          <div class="percentile" value="0" style="background:#edf8e9">
            <p class="percentile_label">0%</p>
          </div>
          <div class="percentile" value="25" style="background:#bae4b3">
            <p class="percentile_label">25%</p>
          </div>
          <div class="percentile" value="50" style="background:#74c476">
            <p class="percentile_label">50%</p>
          </div>
          <div class="percentile" value="75" style="background:#31a354">
            <p class="percentile_label">75%</p>
          </div>
          <div class="percentile" value="100" style="background:#006d2c">
            <p class="percentile_label">100%</p>
          </div>
        </div>
      </div>
      <div class="column">
        <div>
          <!-- <p class="result" id="wrong">Drag the car into the category you think it belongs to. You're not quite there yet!</p>
          <p class="result" id="right">You've got it! This car has a fuel efficiency of <span class="fe"></span> miles per gallon, which puts it into the <span class="fe_percent"></span>th percentile of all the cars in our dataset!</p>
          <p class="result" id="way2low">Cut yourself some slack, your car is better than you think. Click and drag your car to try again!</p> -->
          <br>
          <p class="result" id="low">Your car is a bit greener than you think. Click and drag your car to try again!</p>
          <p class="result" id="right_bad">Good job, you got it! This car has a fuel efficiency of <span class="fe"></span> miles per gallon, which puts it into the <span class="fe_percent"></span>th percentile of all the cars in our dataset! Petroleum costs the US almost $5.2 billion in imports a week and driving a inefficient car can hurt your wallet too. Not to worry, companies are introducing more and more fuel efficient cars. Consider one the next time you buy a car!</p>
          <p class="result" id="right_middle">Good job, you got it! This car has a fuel efficiency of <span class="fe"></span> miles per gallon, which puts it into the <span class="fe_percent"></span>th percentile of all the cars in our dataset! Petroleum costs the US almost $5.2 billion in imports a week and driving a inefficient car can hurt your wallet too. You’re car is just about average, but it can still be better. Companies are introducing more and more fuel efficient cars. Consider one the next time you buy a car!</p>
          <p class="result" id="right_good">Good job, you got it! This car has a fuel efficiency of <span class="fe"></span> miles per gallon, which puts it into the <span class="fe_percent"></span>th percentile of all the cars in our dataset! Your car is fuel efficient, keep up the good work!</p>
          <!-- <p class="result" id="high">Good guess, you’re so close! Click and drag your car to try again!</p> -->
          <p class="result" id="high">Unfortunately, this was too optimistic a guess. Click and drag your car to try again!</p>
        </div>
      </div>
    </div>
  </body>
</html>
